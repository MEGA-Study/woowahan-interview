# JPA - 영속성 컨텍스트

엔티티 매니저를 통해서만 접근할 수 있으며 웹 어플리케이션과 DB 사이에서 전달받은 엔티티 객체를 저장하는 환경

### 특징

1. 1차 캐시

    : 원하는 데이터가 영속성 컨텍스트에 있다면 데이터베이스에 접근하지 않아도 데이터를 조회할 수 있음

2. 엔티티의 동일성(`==`) 보장

    : 엔티티를 저장하고 있기 때문에 

3. 변경 감지

    : 엔티티의 동일성이 보장되기 때문에 별도의 update 호출 없이 객체만 수정해도 변경 사항이 반영됨

4. 지연 로딩

    : 실제 객체 대신 프록시 객체를 로딩해두고 해당 객체를 실제로 사용할 때 영속성 컨텍스트를 통해 데이터를 불러오는 방법

### 엔티티의 생명주기

- **비영속**: 영속성 컨텍스트와 전혀 관계가 없는 상태
- **영속**: 영속성 컨텍스트에 저장된 상태
    - `em.persist()`
- **준영속**: 영속성 컨텍스트에 저장되었다가 분리된 상태
    - `em.detach()` - 특정 엔티티만 지정
    - `em.clear()` - 영속성 컨텍스트 완전히 초기화
    - `em.close()` - 영속성 컨텍스트 종료
- **삭제**: 삭제된 상태
    - `em.remove()`

### 비영속 vs. 준영속

- 영속성 컨텍스트가 제공하는 어떤 기능도 동작하지 않음
- 식별자 값을 가짐
- 지연로딩을 할 수 없음

*그럼 삭제된 엔티티 정보를 DB에서 다시 불러오면 동일성 보장이 안되나?*
